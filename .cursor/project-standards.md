# Общие стандарты проекта

## Архитектура и организация

### Монорепозиторий

- Использовать `@qbs-autonaim/*` пакеты для внутренней коммуникации
- Соблюдать dependency direction (db → api → app)
- Использовать bun для всех операций с зависимостями

### Файловая структура

- `apps/app/` - Next.js приложение
- `packages/api/` - tRPC API слой
- `packages/db/` - Drizzle ORM и схемы
- `packages/ui/` - UI компоненты

## Качество кода

### TypeScript

- Строгая типизация без `any`, `unknown`
- Брендированные типы для доменных сущностей
- Правильное использование дженериков

### Валидация

- Zod v4 для всех входных данных
- Валидация на границах (API, компоненты)
- Очистка пользовательского контента

### Ошибки

- Использовать TRPCError с правильными кодами
- Сообщения на русском языке
- Правильная обработка всех исключений

## Производительность

### React/Next.js

- Server Components по умолчанию
- Правильное использование хуков
- Мемоизация тяжелых вычислений

### База данных

- Оптимизированные запросы с includes
- Использование индексов
- Кэширование частых запросов

### AI интеграция

- Стриминг для длинных ответов
- Кэширование AI ответов
- Rate limiting и валидация

## Безопасность

### Аутентификация

- JWT токены для сессий
- Правильная валидация ролей
- Защита от CSRF

### Данные

- Валидация всех входных данных
- Фильтрация вредоносного контента
- Правильное хранение чувствительных данных

## UX/UI

### Доступность

- ARIA метки и роли
- Клавиатурная навигация
- Контраст и читаемость

### Интерфейс

- Оптимистичные обновления
- Правильные состояния загрузки
- Информативные сообщения об ошибках

## Разработка

### Git

- Четкие commit сообщения
- Feature branches
- Code review обязательный

### Тестирование

- Unit тесты для утилит
- E2E тесты для критических путей
- Playwright для UI тестирования

### Линтинг

- Biome
- Автоматическое форматирование
- Нет warnings в CI

## Специфические домены

### Gig-ы

- Строгое управление состояниями
- Валидация бюджетов и сроков
- Правильные переходы статусов

### AI Чат

- Валидация сообщений
- Обработка стриминга
- Graceful degradation

### Workspace

- Управление членами
- Права доступа
- Уведомления

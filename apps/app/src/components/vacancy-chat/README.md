# AI Vacancy Chat Component

Интеллектуальный помощник для создания вакансий с учётом настроек компании.

## Функциональность

### Основные возможности

- **Умная настройка компании**: Автоматически определяет, есть ли настройки компании, и предлагает их создать/настроить
- **Персонализация бота**: Бот адаптируется под компанию (имя, роль, описание)
- **Интерактивный чат**: Поддержка быстрых ответов и свободного ввода
- **Предварительный просмотр**: Вакансия формируется в реальном времени
- **Редактирование настроек**: Возможность изменить настройки компании прямо в чате

### Поток работы

#### Для новых компаний (без настроек)

1. Приветственное сообщение с объяснением необходимости настроек
2. Предложение выбрать шаблон или описать компанию свободно
3. Автоматическое создание настроек на основе выбора пользователя
4. Переход к созданию вакансий с персонализированным ботом

#### Для существующих компаний

1. Приветствие от персонализированного бота
2. Предложение выбрать тип специалиста или описать задачу
3. Создание вакансии с учётом специфики компании

### Настройки компании

Сохраняются в таблице `bot_settings` и включают:

- `companyName` - Название компании
- `companyDescription` - Описание деятельности
- `companyWebsite` - Сайт компании
- `botName` - Имя виртуального рекрутера
- `botRole` - Роль/должность бота

### API интеграция

#### Получение настроек

```typescript
const { data: botSettings } = trpc.workspace.getBotSettings.useQuery({
  workspaceId,
});
```

#### Обновление настроек

```typescript
const updateMutation = trpc.workspace.updateBotSettings.useMutation({
  onSuccess: () => {
    // Настройки обновлены
  }
});
```

#### Создание вакансии через чат

```typescript
const chatMutation = trpc.vacancy.chatGenerate.mutation({
  workspaceId,
  message: "Ищу React разработчика",
  currentDocument: {}, // текущее состояние документа
  conversationHistory: [], // история чата
});
```

## Архитектура

### Компоненты

- `AIVacancyChat` - основной компонент чата
- `useAIVacancyChat` - хук управления состоянием чата
- `VacancyCreatorContainer` - контейнер для создания вакансий

### Хуки

- `useAIVacancyChat` - управляет логикой чата, сообщениями, документом
- Автоматически определяет режим работы (настройка компании / создание вакансии)

### API роуты

- `workspace.getBotSettings` - получение настроек компании
- `workspace.updateBotSettings` - обновление настроек компании
- `vacancy.chatGenerate` - генерация контента через AI

## UX/UI особенности

### Адаптивный дизайн

- На мобильных устройствах чат занимает всю высоту
- На десктопе разделён на чат (2/5) и превью документа (3/5)

### Визуальные индикаторы

- Иконка бота в превью настроек компании
- Цветовые индикаторы для разных типов сообщений
- Анимации для плавного появления сообщений

### Доступность

- ARIA-метки для всех интерактивных элементов
- Поддержка клавиатурной навигации
- Семантическая структура

## Безопасность

- Валидация всех входных данных через Zod схемы
- Проверка прав доступа к workspace
- Ограничение длины сообщений
- Фильтрация потенциально опасного контента

## Производительность

- Streaming для ответов AI (плавное отображение текста)
- Оптимистичные обновления
- Кэширование настроек компании
- Лимиты на историю сообщений (последние 10)

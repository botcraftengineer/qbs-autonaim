/**
 * Промпт для этапа ожидания PIN-кода
 */
export function buildAwaitingPinPrompt(
  historyText: string,
  alreadyGreeted = false,
  resumeLanguage = "en",
): string {
  // Инструкция по адаптации к языку
  const languageInstruction = `\n⚠️ АДАПТАЦИЯ К ЯЗЫКУ: 
- Изначальный язык резюме: "${resumeLanguage}"
- Если есть ИСТОРИЯ ДИАЛОГА ниже - анализируй язык сообщений кандидата
- Отвечай на том языке, на котором пишет кандидат
- Если истории нет - начни на языке резюме`;

  const greetingInstruction = alreadyGreeted
    ? "- ⚠️ ТЫ УЖЕ ЗДОРОВАЛСЯ - НЕ ЗДОРОВАЙСЯ СНОВА!\n"
    : "";

  return `${languageInstruction}
⚠️ ЭТАП 1: ОЖИДАНИЕ PIN-КОДА
Кандидат еще не идентифицирован. Ты не можешь начать интервью без идентификации.

${historyText ? `ИСТОРИЯ ДИАЛОГА (для контекста):\n${historyText}\n` : ""}

СТРОГОЕ ПРАВИЛО ПРИВЕТСТВИЯ:
- ЗАПРЕЩЕНО использовать слово "Привет"
- ОБЯЗАТЕЛЬНО используй только "Добрый день" или "Здравствуйте"
${greetingInstruction}
ТВОЯ ЗАДАЧА:
- Если это первое сообщение — поприветствуй и попроси 4-значный код
- Если кандидат написал что-то кроме 4-значного кода — мягко верни его к запросу кода
- Если кандидат прислал голосовое — объясни, что сначала нужен код для идентификации
- Объясни, что код нужен для идентификации
- Не начинай интервью, не отвечай на вопросы о работе
- Пиши коротко и по делу (1-2 предложения максимум)

ПРИМЕРЫ ХОРОШИХ ОТВЕТОВ:
- Первое сообщение: "Добрый день! Отправьте 4-значный код, чтобы начать"
- Если не код: "Для начала отправьте 4-значный код"
- Если голосовое: "Сначала отправьте код, чтобы я понял, кто вы. Потом послушаю голосовое"
- Если спрашивают "Какой код?": "Код из 4 цифр, который пришел в чат HH.ru. Проверьте переписку там"
- Если жалуются на код: "Если не можете найти код - напишите, я передам информацию коллеге"`;
}

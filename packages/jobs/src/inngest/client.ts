import { realtimeMiddleware } from "@inngest/realtime/middleware";
import { EventSchemas, Inngest } from "inngest";
import {
  candidateOfferSendDataSchema,
  candidateWelcomeBatchDataSchema,
  candidateWelcomeDataSchema,
  collectChatIdsDataSchema,
  conversationMessageReceivedDataSchema,
  conversationMessageSendDataSchema,
  interviewAnalysisDataSchema,
  interviewCompleteDataSchema,
  interviewSendQuestionDataSchema,
  parseMissingContactsDataSchema,
  parseNewResumesDataSchema,
  refreshSingleResumeDataSchema,
  responseScreenDataSchema,
  screenAllResponsesDataSchema,
  screenNewResponsesDataSchema,
  screenResponsesBatchDataSchema,
  telegramAuthErrorDataSchema,
  telegramUnidentifiedMessageSendDataSchema,
  vacancyRequirementsExtractDataSchema,
  vacancyResponsesRefreshDataSchema,
  vacancyUpdateActiveDataSchema,
  vacancyUpdateSingleDataSchema,
  verifyHHCredentialsDataSchema,
  voiceTranscriptionDataSchema,
} from "./types";

// Create Inngest client with Zod schemas for type-safe events
export const inngest = new Inngest({
  id: "qbs-autonaim",
  name: "QBS Автонайм Jobs",
  middleware: [realtimeMiddleware()],
  schemas: new EventSchemas().fromSchema({
    "vacancy/requirements.extract": vacancyRequirementsExtractDataSchema,
    "response/screen": responseScreenDataSchema,
    "response/screen.new": screenNewResponsesDataSchema,
    "response/screen.all": screenAllResponsesDataSchema,
    "response/screen.batch": screenResponsesBatchDataSchema,
    "response/resume.parse-new": parseNewResumesDataSchema,
    "response/resume.refresh": refreshSingleResumeDataSchema,
    "response/contacts.parse-missing": parseMissingContactsDataSchema,
    "vacancy/update.active": vacancyUpdateActiveDataSchema,
    "vacancy/update.single": vacancyUpdateSingleDataSchema,
    "vacancy/responses.refresh": vacancyResponsesRefreshDataSchema,
    "vacancy/chat-ids.collect": collectChatIdsDataSchema,
    "candidate/welcome": candidateWelcomeDataSchema,
    "candidate/welcome.batch": candidateWelcomeBatchDataSchema,
    "candidate/offer.send": candidateOfferSendDataSchema,
    "telegram/message.received": conversationMessageReceivedDataSchema,
    "telegram/message.send": conversationMessageSendDataSchema,
    "telegram/message.send.by-username":
      telegramUnidentifiedMessageSendDataSchema,
    "telegram/voice.transcribe": voiceTranscriptionDataSchema,
    "telegram/interview.analyze": interviewAnalysisDataSchema,
    "telegram/interview.send-question": interviewSendQuestionDataSchema,
    "telegram/interview.complete": interviewCompleteDataSchema,
    "telegram/auth.error": telegramAuthErrorDataSchema,
    "integration/verify-hh-credentials": verifyHHCredentialsDataSchema,
  }),
});

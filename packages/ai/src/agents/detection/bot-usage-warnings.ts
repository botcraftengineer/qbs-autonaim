/**
 * Библиотека вежливых предупреждений для кандидатов,
 * подозреваемых в использовании AI-ботов
 */

export type WarningLevel = "none" | "soft" | "direct" | "strict" | "final";

/**
 * Предупреждения разных уровней строгости
 */
export const BOT_USAGE_WARNINGS: Record<
  Exclude<WarningLevel, "none">,
  string[]
> = {
  // Мягкое предупреждение (MEDIUM level, первый раз)
  // Не обвиняем, просто просим конкретику
  soft: [
    "Интересно! А можете привести конкретный пример из вашей практики?",
    "Понял. А как это выглядело в реальном проекте? Расскажите случай.",
    "Хорошо. А был ли у вас конкретный кейс, когда вы это применяли?",
    "Ясно. Расскажите историю из опыта — когда вы с этим столкнулись?",
    "Окей. А на практике как это было? Приведите пример.",
  ],

  // Прямое предупреждение (MEDIUM level повторно, или начальный HIGH)
  // Мягко указываем на шаблонность
  direct: [
    "Ваш ответ звучит немного... общо. Мне интереснее услышать конкретный случай из вашего опыта.",
    "Это хорошая теория, но расскажите про реальную ситуацию — когда вы лично с этим работали?",
    "Понимаю подход, но хочу услышать именно вашу историю. Был конкретный проект?",
    "Ответ структурированный, но мне важнее живой пример. Расскажите случай из практики?",
  ],

  // Строгое предупреждение (HIGH level)
  // Прямо говорим о подозрениях, но вежливо
  strict: [
    "Хочу быть честным: ваши ответы выглядят немного шаблонно. Это может повлиять на оценку. Давайте попробуем иначе — расскажите своими словами о конкретном опыте?",
    "Замечу, что ответы звучат как из учебника. Мне важнее понять именно вас и ваш опыт. Можете рассказать реальную историю?",
    "Ваши ответы очень... отполированные. Но мне интереснее услышать живой опыт, пусть и не идеальный. Расскажите случай из практики?",
  ],

  // Финальное предупреждение (HIGH level повторно)
  // Предупреждаем о последствиях
  final: [
    "К сожалению, вынужден отметить: ваши ответы не выглядят самостоятельными. Это будет учтено в оценке. Если хотите продолжить — пожалуйста, отвечайте своими словами.",
    "Я понимаю желание произвести впечатление, но копирование ответов влияет на оценку негативно. Давайте попробуем ещё раз — расскажите честно о своём опыте?",
  ],
};

/**
 * Получить случайное предупреждение нужного уровня
 */
export function getWarningMessage(level: WarningLevel): string | null {
  if (level === "none") return null;

  const messages = BOT_USAGE_WARNINGS[level];
  return messages[Math.floor(Math.random() * messages.length)];
}

/**
 * Определить уровень предупреждения на основе suspicionLevel и истории
 */
export function determineWarningLevel(
  suspicionLevel: "NONE" | "LOW" | "MEDIUM" | "HIGH",
  previousWarningCount: number,
): WarningLevel {
  if (suspicionLevel === "NONE" || suspicionLevel === "LOW") {
    return "none";
  }

  if (suspicionLevel === "HIGH") {
    if (previousWarningCount >= 2) return "final";
    if (previousWarningCount >= 1) return "strict";
    return "direct";
  }

  // MEDIUM
  if (previousWarningCount >= 2) return "direct";
  if (previousWarningCount >= 1) return "direct";
  return "soft";
}

/**
 * Рекомендации для интервьюера на основе результатов детекции
 */
export function getInterviewerRecommendation(
  suspicionLevel: "NONE" | "LOW" | "MEDIUM" | "HIGH",
  warningCount: number,
): string {
  if (suspicionLevel === "HIGH" && warningCount >= 2) {
    return "Зафиксировать в оценке. Кандидат систематически использует AI. Завершить интервью или задать очень специфичные вопросы о деталях проекта.";
  }

  if (suspicionLevel === "HIGH") {
    return "Выдать строгое предупреждение. Задать уточняющий вопрос о конкретном опыте с деталями, которые сложно сгенерировать.";
  }

  if (suspicionLevel === "MEDIUM" && warningCount >= 1) {
    return "Продолжить с фокусом на конкретных примерах. Задавать вопросы о деталях: имена коллег, названия проектов, конкретные числа.";
  }

  if (suspicionLevel === "MEDIUM") {
    return "Мягко направить к конкретным примерам из личного опыта. Не обвинять, просто просить детали.";
  }

  return "Продолжить интервью в обычном режиме.";
}

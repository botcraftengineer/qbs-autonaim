# Отчет о реализованной функциональности платформы Selectio

## Резюме

Разработана полнофункциональная платформа автоматизации рекрутинга с интеграцией HeadHunter и Telegram. Система состоит из трех основных модулей: API-сервер, фоновые задачи и Telegram-клиент. Реализован полный цикл работы с кандидатами: от парсинга откликов до автоматического проведения интервью через Telegram с использованием искусственного интеллекта.

---

## 1. API-сервер (Backend)

### Реализованная архитектура

Построен type-safe API на базе tRPC, обеспечивающий полную типизацию между клиентом и сервером. Внедрена система аутентификации через Better Auth с разделением на публичные и защищенные эндпоинты. В dev-режиме добавлена искусственная задержка для имитации реальных сетевых условий.

### Управление пользователями и компаниями

Реализован полный CRUD для пользовательских аккаунтов: получение профиля, обновление данных, удаление аккаунта. Добавлено управление информацией о компании работодателя. Внедрена система workspace для мультитенантности - каждая компания работает в изолированном пространстве с собственными участниками и правами доступа.

### Интеграции с внешними сервисами

Создан модуль управления интеграциями, позволяющий подключать аккаунты HeadHunter и Telegram. Пользователи могут добавлять, редактировать и удалять интеграции. Система автоматически проверяет валидность учетных данных и уведомляет об ошибках авторизации.

### Работа с вакансиями

Реализован комплексный функционал управления вакансиями:

- Просмотр всех вакансий и фильтрация по статусу активности
- Детальная информация по каждой вакансии
- Аналитика и статистика откликов
- Дашборд с ключевыми метриками
- Графики динамики откликов

Для каждой вакансии доступна работа с откликами кандидатов: просмотр с различными фильтрами (все, недавние, топовые), подсчет количества, отправка приветственных сообщений как по ID, так и по username в Telegram.

### Telegram-интеграция

Разработан полноценный модуль для работы с Telegram:

- Получение истории диалогов и сообщений
- Отправка сообщений кандидатам
- Работа с файлами и медиа
- Транскрибация голосовых сообщений

Реализована система авторизации Telegram-аккаунтов: отправка кода подтверждения, вход по коду, поддержка двухфакторной аутентификации. Добавлено управление активными сессиями с возможностью их удаления и повторной авторизации. Система автоматически отслеживает ошибки авторизации и уведомляет пользователей.

---

## 2. Фоновые задачи (Jobs)

### Архитектурное решение

Выбрана event-driven архитектура на базе Inngest для обработки асинхронных задач. Это обеспечивает надежность выполнения, автоматические повторы при ошибках и масштабируемость системы. Все задачи изолированы и могут выполняться параллельно.

### Автоматизация работы с вакансиями

Реализован автоматический парсинг вакансий с HeadHunter:

- Периодическое обновление активных вакансий
- Обновление откликов по каждой вакансии
- Сбор контактных данных кандидатов
- Извлечение требований из описания вакансии с помощью AI

Система анализирует текст вакансии и автоматически выделяет ключевые требования к кандидатам, что используется для последующего скрининга резюме.

### Интеллектуальный скрининг резюме

Внедрена система автоматического анализа резюме на базе OpenAI GPT-4:

- Скрининг новых откликов в реальном времени
- Пакетная обработка существующих откликов
- Сопоставление опыта кандидата с требованиями вакансии
- Формирование рекомендаций по каждому кандидату

Парсер извлекает детальную информацию из резюме: опыт работы, навыки, образование, контакты. Система автоматически загружает PDF-версии резюме в S3 для долгосрочного хранения.

### Автоматизация коммуникации

Реализована система автоматической отправки приветственных сообщений кандидатам:

- Генерация персонализированных сообщений
- Пакетная отправка с контролем нагрузки
- Отправка через Telegram и HeadHunter

Система извлекает Telegram username из резюме.

### AI-интервью в Telegram

Разработан модуль автоматического проведения интервью:

- Транскрибация голосовых сообщений через Whisper API
- Анализ ответов кандидата с помощью GPT-4
- Генерация следующих вопросов на основе контекста беседы
- Формирование итоговой оценки кандидата

Система ведет естественный диалог, адаптируя вопросы под ответы кандидата. По завершении интервью автоматически формируется заключение с рекомендациями.

### Парсинг HeadHunter

Создан робастный парсер для HeadHunter с имитацией человеческого поведения:

- Авторизация с сохранением cookies
- Парсинг списка вакансий и откликов
- Извлечение детальной информации из резюме
- Обновление данных об откликах

Реализована система имитации человеческого поведения: случайные задержки, скроллинг, движение мыши, имитация чтения. Это снижает риск блокировки со стороны HeadHunter.

---

## 3. Telegram-клиент

### Мультитенантная архитектура

Разработан менеджер для управления множественными Telegram-ботами. Каждый workspace имеет собственного бота, работающего от отдельного аккаунта. Система автоматически запускает всех ботов при старте сервера и поддерживает их работоспособность.

Реализован механизм автоматического обнаружения ошибок авторизации: при обнаружении невалидной сессии бот автоматически останавливается, сессия деактивируется в БД, и отправляется уведомление администратору workspace через Inngest.

### Обработка сообщений

Создан интеллектуальный обработчик входящих сообщений:

- Команда /start для инициализации диалога
- Обработка текстовых сообщений с контекстными ответами
- Прием голосовых сообщений и аудиофайлов
- Автоматическая загрузка медиа в S3

Система имитирует естественное человеческое поведение:

- Автоматическая отметка сообщений как прочитанных
- Индикатор "печатает..." перед ответом
- Случайные задержки, зависящие от длины сообщения
- Естественные формулировки без упоминания "бот"

Ответы адаптируются под статус интервью: если интервью активно, бот просит записать голосовое; если завершено - сообщает о передаче результатов руководству.

### REST API для управления

Разработан HTTP API на базе Hono для внешнего управления клиентами:

**Авторизация:**

- Отправка кода подтверждения на номер телефона
- Вход по коду с получением данных пользователя
- Проверка 2FA пароля при необходимости

**Отправка сообщений:**

- По chat ID для существующих диалогов
- По username для поиска пользователя
- По номеру телефона с автоматическим добавлением в контакты

Все эндпоинты валидируются через Zod-схемы и возвращают структурированные ответы с обработкой специфичных Telegram-ошибок.

### Управление сессиями

Реализовано кастомное хранилище сессий с возможностью экспорта/импорта. Это позволяет сохранять сессии в БД и восстанавливать их при перезапуске сервера. Каждая сессия изолирована по workspace, что обеспечивает безопасность в мультитенантной среде.

---

## Технологический стек

**Backend:**

- tRPC для type-safe API
- Better Auth для аутентификации
- PostgreSQL через Drizzle ORM

**Фоновые задачи:**

- Inngest для event-driven архитектуры
- OpenAI GPT-4 для AI-анализа
- Whisper API для транскрибации
- Crawlee + Playwright для парсинга

**Telegram:**

- MTCute для MTProto протокола
- Hono для REST API
- S3 для хранения медиа

**Общее:**

- TypeScript в strict mode
- Zod для валидации данных
- Monorepo на Turborepo

---

## Ключевые достижения

1. **Полная автоматизация рекрутинга** - от получения отклика до проведения интервью без участия человека

2. **Интеллектуальный скрининг** - AI анализирует резюме и сопоставляет с требованиями вакансии, экономя время рекрутера

3. **Естественная коммуникация** - бот общается как человек, кандидаты не замечают автоматизацию

4. **Масштабируемость** - архитектура поддерживает неограниченное количество workspace и ботов

5. **Надежность** - автоматическое восстановление после ошибок, повторы задач, мониторинг сессий

6. **Type Safety** - полная типизация от БД до фронтенда исключает целый класс ошибок
